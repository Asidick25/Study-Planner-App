
# Imports 
import os
import pytest
from app import app

# Fixture to create test client for Flask
@pytest.fixture

def client():
    # Enable testing mode
    app.config['Testing'] = True
    # Using test client for the app
    with app.test_client() as client:
        yield client


def test_file_uplaod(client):
    """ Testing that a valid file upload gets processed correctly."""
    # Path to data 
    file_path = r"C:\Users\insha\Documents\Software Engineering Y3\Summative1\Study-Planner-App\DS OCTOBER 2022 TIMETABLE.xlsx"

    # Uploading the file
    data = {'file': (open(file_path, 'rb'), 'DS OCTOBER 2022 TIMETABLE.xlsx')}

    # POST Request
    response = client.post('/', data=data, content_type='multipart/form-data')

    # Ensure request is successful
    assert response.status_code == 200

    # Checking if years are returned
    assert b"years" in response.data
